<html>
    <head>
        <link rel="stylesheet" href="styles.css">
        <title>SMPU incredible developpement website</title>
    </head>
    <body>
        <h1>PLEASE WAIT 2 SECONDS BEFORE PRESSING A BUTTON I NEED GOOGLE SHEETS TO UPDATE :)</h1>
        <script>

            fetch("https://sheetdb.io/api/v1/seqwd5cxb9ovv/?name=bug_found")
                .then(res => {
                    return res.json();
                }).then(data => {
                    data.forEach(user =>{
                        var value = user.value;
                        document.getElementById("clicks").innerHTML = parseInt(value);
                    }
                    )
                }
                )

            function addBug() {
                fetch("https://sheetdb.io/api/v1/seqwd5cxb9ovv/?name=bug_found")
                .then(res => {
                    return res.json();
                }).then(data => {
                    data.forEach(user =>{
                        var value = user.value;
                        clicks = parseInt(value);
                        clicks += 1;
                        document.getElementById("clicks").innerHTML = clicks;

                        const newValue = {
                            value: clicks
                        }

                        fetch("https://sheetdb.io/api/v1/seqwd5cxb9ovv/name/bug_found", {
                        method: "PUT",
                        headers: {
                            "Content-type": "application/json",
                        },
                        body: JSON.stringify(newValue)
                        }).then(res => {
                            if (!res.ok){
                                console.log("Problem!");
                                return;
                            }

                            return res.json()
                        }).then(data => {
                            console.log("Success!");
                        }).catch(error => {
                            console.log(error);
                        })
                    })
                }).catch(error => console.log(error));

                };
            function removeBug() {
                fetch("https://sheetdb.io/api/v1/seqwd5cxb9ovv/")
                .then(res => {
                    return res.json();
                }).then(data => {
                    data.forEach(user =>{
                        var value = user.value;
                        clicks = parseInt(value);
                        clicks -= 1;
                        document.getElementById("clicks").innerHTML = clicks;

                        const newValue = {
                            value: clicks
                        }

                        fetch("https://sheetdb.io/api/v1/seqwd5cxb9ovv/name/bug_found", {
                        method: "PUT",
                        headers: {
                            "Content-type": "application/json",
                        },
                        body: JSON.stringify(newValue)
                        }).then(res => {
                            if (!res.ok){
                                console.log("Problem!");
                                return;
                            }

                            return res.json()
                        }).then(data => {
                            console.log("Success!");
                        }).catch(error => {
                            console.log(error);
                        })
                    })
                }).catch(error => console.log(error));

                };
        </script>
        <button style="font-size: 300%;" type="button" onclick="addBug()">Click to add 1 bug</button>
        <button type="button" onclick="removeBug()">Click to remove 1 bug</button>
        <p>Bugs found : <a id="clicks">0</a></p>
    </body>
</html>